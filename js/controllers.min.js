function DialogController(t,i,r,o,s,a){t.dimension=r,t.distrito=o,t.informacion=s,t.color=a,t.hide=function(){i.hide()},t.cancel=function(){i.cancel()},t.answer=function(t){i.hide(t)}}app.controller("mainController",function(t,i,r,o,s){function a(t){var i=t>=0?1:-1
t=Math.abs(t)
var r=.254829592,o=-.284496736,s=1.421413741,a=-1.453152027,e=1.061405429,c=.3275911,n=1/(1+c*t),l=1-((((e*n+a)*n+s)*n+o)*n+r)*n*Math.exp(-t*t)
return i*l}function e(t){return.5*(1+a(t/Math.sqrt(2)))}var c={color_zona:{2:"#AA904A",1:"#8A324E",3:"#77C24F",4:"#4061AC"},color_sector:{"Educación":"#F37D30",Salud:"#64ACA3",Pobreza:"#AD9150",Empleo:"#31656E","Actividad Económica":"#76AB54"},formato_metrica:function(t,i){var r=""
return r="porcentaje"==i?s("number")(100*t,1)+" %":"entero"==i?s("number")(t,0):s("number")(t,1)}},n={distritos:{},raw_data:{},ambiente:{},sectores:{},metricas:{},informacion:{},selector:{},simular:{},varianza:{},resultado:{},calificacion:{},quintiles:{},distrito:{seleccionado:"Selecciona un distrito",drop:!1,sin_seleccionar:!1},metrica_sector:{metrica:"",sector:""},mapa:{path:{},bounds:{northEast:{lat:-7.348846969785414,lng:-77.74749755859375},southWest:{lat:-8.977323208440273,lng:-79.99969482421875}},defaults:{keyboard:!1,dragging:!1,doubleClickZoom:!1,scrollWheelZoom:!1,tap:!1,touchZoom:!1,zoomControl:!1,controls:{layers:{visible:!1}}},layers:{overlays:{distritos:{name:"Distritos Layer",type:"group",visible:!0}}},events:{path:{enable:["click"]}},tiles:{url:"http://{s}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}}},init:function(t){this.distritos=t.distritos,this.raw_data=t.raw_data,this.ambiente=t.ambiente,this.sectores=t.sectores,this.metricas=t.metricas,this.informacion=t.informacion
for(metrica in this.raw_data){this.selector[metrica]={},this.simular[metrica]={}
for(distrito in this.raw_data[metrica])this.selector[metrica][distrito]="actual",this.simular[metrica][distrito]=!1}for(distrito in this.distritos)this.mapa.path[distrito]={latlngs:this.distritos[distrito].coordinates,stroke:!0,color:"#eeeeee",weight:1,fillColor:c.color_zona[this.distritos[distrito].zona],fillOpacity:.9,type:"polygon",layer:"distritos"}
this.calcular()},calcular:function(){for(metrica in this.raw_data){var t=0
for(distrito in this.raw_data[metrica]){var i=this.raw_data[metrica][distrito],r=this.selector[metrica][distrito]
t+=Math.pow(i[r]-i.optimo,2)}this.varianza[metrica]=Math.pow(t/Object.keys(this.raw_data[metrica]).length,.5)}for(metrica in this.raw_data){this.resultado[metrica]={}
for(distrito in this.raw_data[metrica]){var i=this.raw_data[metrica][distrito],r=this.selector[metrica][distrito],o=this.metricas[metrica].clase*(i[r]-i.optimo),s=this.varianza[metrica]
if(0!=s)var a=e(o/s)
else var a=e(0)
var c=Math.ceil(a/.2)
this.resultado[metrica][distrito]={p_value:a,quintil:c}}}for(distrito in this.distritos){var n=0
for(metrica in this.metricas)n+=this.resultado[metrica][distrito].p_value
this.calificacion[distrito]=n/Object.keys(this.metricas).length}for(distrito in this.distritos){this.quintiles[distrito]={}
for(sector in this.sectores){var l=1
for(metrica in this.sectores[sector])l*=this.resultado[metrica][distrito].p_value
var h=Math.pow(l,1/Object.keys(this.sectores[sector]).length)
this.quintiles[distrito][sector]=Math.ceil(h/.2)}}},seleccionar_distrito:function(t){this.distrito.sin_seleccionar&&(this.mapa.path[this.distrito.seleccionado].weight=1),this.distrito.seleccionado=t,this.mapa.path[t].weight=3,this.distrito.sin_seleccionar=!0,this.distrito.drop=!1},simular_metrica:function(t,i){"optimo"==this.selector[t][i]?this.selector[t][i]="actual":this.selector[t][i]="optimo",this.calcular()},simular_sector:function(t,i){for(metrica in this.sectores[t])this.simular[metrica][i]=!this.simular[metrica][i],this.simular_metrica(metrica,i)},ver_zonas:function(){this.metrica_sector.sector="",this.metrica_sector.metrica=""
for(distrito in this.distritos)this.mapa.path[distrito]={latlngs:this.distritos[distrito].coordinates,stroke:!0,color:"#eeeeee",weight:1,fillColor:c.color_zona[this.distritos[distrito].zona],fillOpacity:.9,type:"polygon",layer:"distritos"}},ver_metrica_mapa:function(t,i){this.metrica_sector.sector="",this.metrica_sector.metrica=t
for(distrito in this.distritos)this.mapa.path[distrito].fillColor=c.color_sector[i],this.mapa.path[distrito].fillOpacity=1-this.resultado[t][distrito].p_value},ver_sector_mapa:function(t){this.metrica_sector.metrica="",this.metrica_sector.sector=t
for(distrito in this.distritos)this.mapa.path[distrito].fillColor=c.color_sector[t],this.mapa.path[distrito].fillOpacity=this.quintiles[distrito][t]/5}}
t.chavimochic=n,t.estilo=c,i.get("data.json").then(function(t){n.init(t.data)}),t.templates=[{nombre:"introduccion",url:"templates/introduction.html"},{nombre:"indicadores",url:"templates/indicators.html"}],t.template=t.templates[0],t.comenzar=function(i){t.template=t.templates[i]},t.mostrar_informacion=function(i,s,a,e,c){var n=(o("sm")||o("xs"))&&t.customFullscreen
r.show({controller:DialogController,templateUrl:"dialogInformation.tmpl.html",parent:angular.element(document.body),targetEvent:i,locals:{dimension:s,distrito:a,informacion:e,color:c},clickOutsideToClose:!0,fullscreen:n}).then(function(i){t.status='You said the information was "'+i+'".'},function(){t.status="You cancelled the dialog."})},t.$on("leafletDirectivePath.map.click",function(t,i){n.seleccionar_distrito(i.modelName)})}),app.filter("orderDistritos",function(){return function(t,i,r){var o=[]
return angular.forEach(t,function(t,i){t.zona==r&&(t.key=i,o.push(t))}),o.sort(function(t,r){return i[t.key]>i[r.key]?-1:1}),o}})